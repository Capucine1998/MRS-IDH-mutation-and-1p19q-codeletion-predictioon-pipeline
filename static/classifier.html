<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classifier</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="/static/classifier.js"></script>
</head>
<body>
    <header>
        <div class="header-container">
            <img src="/static/img/paris_institute_of_brain_logo.png" alt="Logo" class="logo">
            <div class="title-container">
                <h1>IDH & 1p/19q MRS Classifier</h1>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="/static/mrs-processing.html" class="nav-button unpressed">MEGA-PRESS Processing</a></li>
                <li><a href="/static/classifier.html" class="nav-button pressed">IDH & 1p/19q Classifier</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Hidden button for auto-triggering classifier -->
        <button id="auto-trigger-classifier" style="display:none" onclick="runPythonScript(new Event('submit'))">Auto Trigger</button>

        <div id="classifier" class="section">
            <div class="container">
                <div class="form_fake" style="margin-bottom: 1.5em;">
                    <h2 style="margin-top: 0; color: #223D70;">Research Prototype (Not for Clinical Use)</h2>
                    <p style="margin: 0 0 0.75em 0;">
                        This classifier is a prototype developed from research/clinical data. It is intended for research and educational purposes only.
                    </p>
                    <p style="margin: 0 0 0.75em 0;">
                        <span style="color: #b00020; font-weight: 700;">It must not be used as a clinical diagnosis tool.</span> Clinical use would require appropriate prospective clinical validation (e.g., clinical trials) and regulatory evaluation.
                    </p>
                    <p style="margin: 0 0 0.75em 0;">
                        When used responsibly, it may help support non-invasive molecular status prediction alongside ground-truth histopathological / molecular analysis.
                    </p>
                    <p style="margin: 0;">
                        This is an early step toward potential clinical translation and is expected to improve as it is trained and validated on larger datasets over time. If you would like to collaborate (e.g., contribute glioma MEGA-PRESS MRS data) or need support for molecular detection from MRS, please contact the team maintaining this website.
                    </p>
                </div>

                <div class="form_fake" style="margin-bottom: 1.5em;">
                    <h2 style="margin-top: 0; color: #223D70;">LCModel file requirements</h2>
                                      <p style="margin: 0 0 0.75em 0;">
                        These LCModel output files can be obtained by running the <a href="/static/mrs-processing.html">MEGA-PRESS processing pipeline</a> available on this website.
                    </p>

                    <p style="margin: 0 0 0.75em 0;">
                        If you want to use your own LCModel-processed data, your basis-set must include the following fitted metabolites for the classifier to work.
                    </p>
  
                    <h3 style="margin: 0.75em 0 0.25em 0;">IDH prediction</h3>
                    <p style="margin: 0 0 0.25em 0;"><strong>Non edited metabolites:</strong></p>
                    <ul style="margin: 0 0 0.75em 1.25em;">
                        <li>2HG</li>
                        <li>Glutathione</li>
                        <li>Glutamate + Glutamine</li>
                        <li>Alanine</li>
                        <li>Glutamate</li>
                        <li>Betaine</li>
                        <li>Glycine</li>
                        <li>GABA</li>
                        <li>Glutamine</li>
                        <li>Lip13a+Lip13b+Lip0+MM09</li>
                        <li>Lip20</li>
                        <li>syo-inositol</li>
                    </ul>

                    <p style="margin: 0 0 0.25em 0;"><strong>Edited metabolites:</strong></p>
                    <ul style="margin: 0 0 0.75em 1.25em;">
                        <li>2-Hydroxyglutarate</li>
                        <li>CRLB 2-Hydroxyglutarate</li>
                        <li>GABA</li>
                    </ul>

                    <h3 style="margin: 0.75em 0 0.25em 0;">1p/19q codeletion prediction (in addition to IDH)</h3>
                    <p style="margin: 0 0 0.25em 0;"><strong>Non edited metabolites:</strong></p>
                    <ul style="margin: 0 0 0.75em 1.25em;">
                        <li>Cystathionine</li>
                        <li>Macromolecules</li>
                        <li>Total Choline</li>
                        <li>Citrate</li>
                        <li>Glucose</li>
                        <li>myo-inositol</li>
                        <li>Lip13a+Lip13b+Lip0+MM09</li>
                    </ul>

                    <p style="margin: 0 0 0.25em 0;"><strong>Edited metabolites:</strong></p>
                    <ul style="margin: 0 0 0.25em 1.25em;">
                        <li>Cystathionine</li>
                        <li>CRLB Cystathionine</li>
                        <li>CRLB 2-Hydroxyglutarate</li>
                    </ul>
                </div>

                <form id="classifierForm" onsubmit="runPythonScript(event)">
                    <div class="form-group">
                        <label for="fileInputCoordOff">Non-edited .COORD files:</label>
                        <input type="file" id="fileInputCoordOff" name="fileInputCoordOff" multiple required>
                    </div>
                    <div class="form-group">
                        <label for="fileInputPrintOff">Non-edited .PRINT files:</label>
                        <input type="file" id="fileInputPrintOff" name="fileInputPrintOff" multiple required>
                    </div>
                    <div class="form-group">
                        <label for="fileInputCoordDiff">Edited .COORD files:</label>
                        <input type="file" id="fileInputCoordDiff" name="fileInputCoordDiff" multiple>
                    </div>
                    <div class="form-group">
                        <label for="fileInputPrintDiff">Edited .PRINT files:</label>
                        <input type="file" id="fileInputPrintDiff" name="fileInputPrintDiff" multiple>
                    </div>
                    <button type="submit">Launch Prediction</button>
                </form>


                <!-- SD Metabolite Plot -->
                <div id="sd-container" style="display: none; margin-top: 2em;">
                    <h2>Standard Deviation (SD) Metabolites</h2>
                </div>

                <!-- Metabolite Analysis Plot -->
                <div id="analysis-container" style="display: none; margin-top: 2em;">
                    <h2>Metabolite Analysis Board</h2>
                    <div class="plot-box">
                        <h3>MEGA-PRESS Metabolite Analysis</h3>
                        <iframe class="plot-frame"></iframe>
                    </div>
                </div>
                
                <p id="result"></p>
                <!-- IDH Status Predictions -->
                <div id="predictions-section-idh" style="display: none;">
                    <h2>IDH Mutation Status Predictions</h2>
                    <table id="predictions-table-idh">
                        <thead>
                            <tr id="predictions-header-idh"></tr>
                        </thead>
                        <tbody id="predictions-body-idh"></tbody>
                    </table>
                </div>
                
                <!-- SHAP Explanation Plots -->
                <div id="shap-explanation-idh" style="display: none; margin-top: 2em;">
                    <h2> IDH Mutation Status Classifier SHAP Explanation</h2>

                    <div class="shap-plot-row">
                        <div class="plot-box">
                            <h3>SHAP Bar Plot (tCho scaled dataset)</h3>
                            <img id="shap_IDH_bar-image_tcho" alt="IDH SHAP Bar (tCho)" class="plot-img" style="display: none;">
                            <button id="download-shap_IDH_bar-button_tcho" style="display: none;">Download</button>
                        </div>
                        <div class="plot-box">
                            <h3>SHAP Beeswarm Plot (tCho scaled dataset)</h3>
                            <img id="shap_IDH_beeswarm-image_tcho" alt="IDH SHAP Beeswarm (tCho)" class="plot-img" style="display: none;">
                            <button id="download-shap_IDH_beeswarm-button_tcho" style="display: none;">Download</button>
                        </div>
                    </div>

                    <div class="shap-plot-row">
                        <div class="plot-box">
                            <h3>SHAP Bar Plot (water scaled dataset)</h3>
                            <img id="shap_IDH_bar-image_water" alt="IDH SHAP Bar (water)" class="plot-img" style="display: none;">
                            <button id="download-shap_IDH_bar-button_water" style="display: none;">Download</button>
                        </div>
                        <div class="plot-box">
                            <h3>SHAP Beeswarm Plot (water scaled dataset)</h3>
                            <img id="shap_IDH_beeswarm-image_water" alt="IDH SHAP Beeswarm (water)" class="plot-img" style="display: none;">
                            <button id="download-shap_IDH_beeswarm-button_water" style="display: none;">Download</button>
                        </div>
                    </div>
                </div>


                <!-- 1p/19q Codeletion Predictions -->
                <div id="predictions-section-1p19q" style="display: none;">
                    <h2>1p/19q Codeletion Predictions</h2>
                    <table id="predictions-table-1p19q">
                        <thead>
                            <tr id="predictions-header-1p19q"></tr>
                        </thead>
                        <tbody id="predictions-body-1p19q"></tbody>
                    </table>
                </div>
    
                <div id="shap-explanation-1p19q" style="display: none; margin-top: 2em;">
                    <h2> 1p/19q Codeletion Classifier SHAP Explanation</h2>

                    <div class="shap-plot-row">
                        <div class="plot-box">
                            <h3>SHAP Bar plot (tCho scaled dataset)</h3>
                            <img id="shap_1p19q_bar-image_tcho" alt="1p19q SHAP Bar (tCho)" class="plot-img" style="display: none;">
                            <button id="download-shap_1p19q_bar-button_tcho" style="display: none;">Download</button>
                        </div>
                        <div class="plot-box">
                            <h3>SHAP Beeswarm plot (tCho scaled dataset)</h3>
                            <img id="shap_1p19q_beeswarm-image_tcho" alt="1p19q SHAP Beeswarm (tCho)" class="plot-img" style="display: none;">
                            <button id="download-shap_1p19q_beeswarm-button_tcho" style="display: none;">Download</button>
                        </div>
                    </div>

                    <div class="shap-plot-row">
                        <div class="plot-box">
                            <h3>SHAP Bar plot (water scaled dataset)</h3>
                            <img id="shap_1p19q_bar-image_water" alt="1p19q SHAP Bar (water)" class="plot-img" style="display: none;">
                            <button id="download-shap_1p19q_bar-button_water" style="display: none;">Download</button>
                        </div>
                        <div class="plot-box">
                            <h3>SHAP Beeswarm plot (water scaled dataset)</h3>
                            <img id="shap_1p19q_beeswarm-image_water" alt="1p19q SHAP Beeswarm (water)" class="plot-img" style="display: none;">
                            <button id="download-shap_1p19q_beeswarm-button_water" style="display: none;">Download</button>
                        </div>
                    </div>
                </div>

                <ul id="lcmodel-file-list"></ul>

                <!--img src="./img/ROC_algo.png" alt="Model performance metrics" class="metric_img"-->
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2026 Paris Brain Institute. All rights reserved.</p>
        </div>
    </footer>

</body>
</html>